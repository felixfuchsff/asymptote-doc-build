<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asymptote: Building Asymptote with CMake (On Windows)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asymptote
   &#160;<span id="projectnumber">3.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Building Asymptote with CMake (On Windows) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md10"></a>
Basic Requirements</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
Required Dependencies</h2>
<p>Ensure the following is installed:</p><ul>
<li>Visual Studio 2022+ or Visual Studio 2022+ build tools.<ul>
<li>Both can be found at <a href="https://visualstudio.microsoft.com/downloads/">here</a>.</li>
</ul>
</li>
<li>CMake<ul>
<li>(Recommended way) Visual Studio/Visual Studio Build Tools provides bundled CMake as a selectable component</li>
<li>Otherwise, CMake can be found <a href="https://cmake.org/">here</a></li>
</ul>
</li>
<li>Python 3+<ul>
<li>Available <a href="https://www.python.org/downloads/windows/">here</a>.</li>
</ul>
</li>
<li>Perl on Windows<ul>
<li>(Recommended way) Strawberry Perl is available at <a href="https://strawberryperl.com/">Strawberry Perl</a>.</li>
<li>(Not recommended due to license terms) ActiveState Perl is available <a href="https://www.activestate.com/products/perl/">here</a>.</li>
</ul>
</li>
<li>Ninja<ul>
<li>(Recommended) Visual Studio/Visual Studio Build Tools provides bundled Ninja as part of CMake build tools</li>
<li>Otherwise, Ninja can be installed using winget by running <code>winget install Ninja-build.Ninja</code>.</li>
<li>If winget is not available, Ninja can be found <a href="https://ninja-build.org/">here</a>. If installing this way, ensure <code>ninja</code> is accessible from <code>PATH</code>.</li>
<li>(Untested) <code>ninja.exe</code> is bundled within a Strawberry Perl installation.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Optional, but highly recommended dependencies</h2>
<ul>
<li>A GCC-compatible C++ compiler (Optional, but highly recommended. See #installing-gcc-compatible-c++-compiler)<ul>
<li>(Recommended way) <a href="https://releases.llvm.org/">here</a>.</li>
<li>(Untested) <code>g++.exe</code> is bundled within a Strawberry Perl installation.</li>
<li>(Untested) Visual Studio also provides clang tools as an installable component. If installing this way, ensure that <code>clang++.exe</code> is available.</li>
</ul>
</li>
<li>Vcpkg (Optional, but highly recommended. See #notes-on-dependency-management)<ul>
<li>Can be found <a href="https://vcpkg.io/">here</a>.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Dependencies for documentation generation (Required only for building a setup file)</h2>
<p>Ensure <a href="https://tug.org/texlive/windows.html">TeX Live</a> is available on the system. <a href="https://miktex.org">MikTeX</a> is a possible substitute but is unsupported.</p>
<p>Building <code>asymptote.pdf</code> requires a UNIX system.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Dependencies for building the setup file</h2>
<p>The following is required for building the setup file:</p><ul>
<li>NSIS installer.<ul>
<li>NSIS installer can be found <a href="https://nsis.sourceforge.io/Download">here</a>.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md15"></a>
For a quick start</h1>
<p>If you are getting started and want a quick configuration, run <code>./quick-start-win32.ps1</code>. This script automatically checks that you have vcpkg, and if not, clones and bootstraps vcpkg on your system.</p>
<p>Additionally, this script automatically locates your Visual Studio installation and establishes all required environment variables.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Notes on Dependency management</h1>
<p>The recommended way is to use <a href="https://vcpkg.io/">vcpkg</a>. See <code>INSTALL.md</code> for more details. On windows, one may run</p>
<div class="fragment"><div class="line">git clone https://github.com/microsoft/vcpkg.git</div>
<div class="line">./vcpkg/bootstrap-vcpkg.bat</div>
</div><!-- fragment --><p> to initialize vcpkg. Make sure the environment <code>VCPKG_ROOT</code> points to where your vcpkg repository is at user or machine scope.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
For User scope</h2>
<p>This can be done either by Start -&gt; "Edit environment variables for your account" and then adding VCPKG_ROOT entry, or by PowerShell,</p>
<div class="fragment"><div class="line">[Environment]::SetEnvironmentVariable(&#39;VCPKG_ROOT&#39;, &#39;&lt;path to vcpkg&gt;&#39;, &#39;User&#39;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
For machine scope</h2>
<p>Otherwise, you can also set VCPKG_ROOT for everyone on your machine.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Using CMake</h1>
<h2><a class="anchor" id="autotoc_md20"></a>
Installing GCC-compatible C++ compiler</h2>
<p>We (highly) suggest installing a GCC-compatible C++ compiler for preprocessing. Our recommendation is to use clang/LLVM tools, available <a href="https://releases.llvm.org/">here</a>. Once your compiler is installed, there are a few options.</p>
<ul>
<li>(Recommended) Ensure <code>clang++.exe</code> is available in <code>PATH</code> and leave <code>GCCCOMPAT_CXX_COMPILER_FOR_MSVC</code> unset. The build script will automatically try to locate <code>clang++.exe</code> or <code>g++.exe</code> in places within <code>PATH</code>. Be warned that the build script may select a different compiler depending on if there are other compilers available in <code>PATH</code>.</li>
<li>(Only if you require a specific clang++ compiler) Set <code>GCCCOMPAT_CXX_COMPILER_FOR_MSVC</code> environment variable to your GCC-compatible C++ compiler. For example <div class="fragment"><div class="line">$env:GCCCOMPAT_CXX_COMPILER_FOR_MSVC=&quot;&lt;LLVM install location&gt;/bin/clang++.exe</div>
</div><!-- fragment --><ul>
<li><p class="startli">If you want to make the environment variable permanent, run ```powershell</p>
<p class="startli">```</p>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md21"></a>
Building steps</h2>
<h3><a class="anchor" id="autotoc_md22"></a>
Environment set up</h3>
<p>Ensure you have <code>cl.exe</code> in your path. The easiest way is to use Visual Studio Developer PowerShell, though be careful that by default VS Developer PowerShell selects 32-bit cl.exe.</p>
<p>To explicitly select 64-bit Visual Studio Developer PowerShell, one can use Visual Studio locator alongside its developer shell script as</p>
<div class="fragment"><div class="line">$vsInfo = Get-CimInstance MSFT_VSInstance -Namespace root/cimv2/vs</div>
<div class="line">&amp; &quot;$($vsInfo.InstallLocation)\Common7\Tools\Launch-VsDevShell.ps1&quot; -Arch amd64 -HostArch amd64 -SkipAutomaticLocation</div>
</div><!-- fragment --><p>This prompt should put you in to 64-bit Visual Studio Developer PowerShell.</p>
<h3><a class="anchor" id="autotoc_md23"></a>
Configuring build files</h3>
<p>There are multiple CMake presets available for building, depending on what you intend to build</p><ul>
<li>If you are building Asymptote for release with setup files, depending on how you would build <code>asymptote.pdf</code>, use either (see #documentation-generation section)<ul>
<li>The <code>msvc/release</code> preset</li>
<li>The <code>msvc/msvc/release/with-existing-asymptote-pdf</code></li>
</ul>
</li>
<li>If you are building only asymptote executable for release, or do not care about <code>asymptote.pdf</code>, use <code>msvc/release</code> preset</li>
<li>If you are building Asymptote for development or debug mode, you are required to either create your own debug preset or configure cache variables manually.</li>
</ul>
<p>Ensure that you are in the Visual Studio 64-bit PowerShell (or have every tool available in <code>PATH</code>), and run </p><div class="fragment"><div class="line">cmake --preset &lt;your selected preset&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md24"></a>
Building Asymptote</h3>
<p>There are multiple key targets for building Asymptote.</p>
<ul>
<li>For the <code>asy.exe</code> executable and <code>base/</code> files, the target to run is <code>asy-with-basefiles</code></li>
<li>For documentation (depending on your configuration, including or excluding <code>asymptote.pdf</code>) - <code>docgen</code></li>
<li>If you are generating an installer file, the target <code>asy-pre-nsis-targets</code> builds all required components, excluding the GUI. See #building-gui-files for instructions on how to build GUI files.</li>
</ul>
<p>The Asymptote binary is available at <code>cmake-build-msvc/release/asy.exe</code> if using <code>msvc/release</code> or <code>msvc/msvc/release/ci/with-external-asymptote-pdf</code> targets. Instructions for generating a setup file are in the next section</p>
<h4><a class="anchor" id="autotoc_md25"></a>
Extra considerations for &lt;tt&gt;asymptote.pdf&lt;/tt&gt;</h4>
<p>On Windows, <code>asymptote.pdf</code> is built using MikTeX's <code>texify</code> program, hence why TeX Live cannot be used here. Additionally, ensure that a replacement for <code>texindex</code> is available in the system. As of the moment, I have only tested using WSL's <code>texindex</code>.</p>
<ul>
<li>If you have a WSL distribution with <code>texindex</code> installed, that may be used as a substitute for <code>texindex</code> on windows. In this case, ensure the cache variable <code>WIN32_TEXINDEX</code> is set to <code>WSL</code>. This is the default option.</li>
<li>If you have a replacement <code>texindex</code> program, ensure <code>WIN32_TEXINDEX</code> points to that file.</li>
</ul>
<h1><a class="anchor" id="autotoc_md26"></a>
Building GUI files</h1>
<h2><a class="anchor" id="autotoc_md27"></a>
Dependencies for GUI files</h2>
<p>All required dependencies for building GUI are present in <code>GUI/requirements.txt</code> and <code>GUI/requirements.dev.txt</code>. We recommend using a virtual environment, for example</p>
<div class="fragment"><div class="line">python.exe -m virtualenv asyguibuild</div>
<div class="line">./asyguibuild/Scripts/activate.ps1</div>
<div class="line"> </div>
<div class="line">cd &lt;asymptote-repo&gt;/GUI</div>
<div class="line">pip install -r requirements.txt</div>
<div class="line">pip install -r requirements.dev.txt</div>
</div><!-- fragment --><p>However, against our recommendations, the dependencies can be also installed into the system interpreter.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Building the GUI files</h2>
<p>The python script <code>GUI/buildtool.py</code> is used for building required files. To do this, run</p>
<div class="fragment"><div class="line">cd &lt;asymptote-repo&gt;/GUI</div>
<div class="line">python.exe buildtool.py build</div>
</div><!-- fragment --><p>This should build all required GUI files.</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Installation file generation</h1>
<h3><a class="anchor" id="autotoc_md30"></a>
Prerequisites for installation file generation</h3>
<p>Ensure that</p><ul>
<li>Requirements for building asymptote executable</li>
<li>Requirements for building documentation (excluding <code>asymptote.pdf</code>)</li>
<li>At least one of the following:<ul>
<li>A pre-built <code>asymptote.pdf</code> file</li>
<li>Requirements for building <code>asymptote.pdf</code> file</li>
</ul>
</li>
<li>PowerShell. This should come pre-installed on windows.<ul>
<li>Ensure that the ability to execute unsigned scripts is enabled</li>
</ul>
</li>
<li>Python 3 with relevant dependencies for building GUI files (This will be discussed in a separate section)</li>
</ul>
<p>are present in the system.</p>
<h3><a class="anchor" id="autotoc_md31"></a>
If using a pre-built &lt;tt&gt;asymptote.pdf&lt;/tt&gt;</h3>
<p>Place <code>asymptote.pdf</code> in the directory <code>&lt;asymptote-repo&gt;/asydoc/</code>. That is, the file <code>&lt;asymptote-repo&gt;/asydoc/asymptote.pdf</code> is present. After that, configure cmake with the preset <code>msvc/release/ci/with-external-asymptote-pdf</code> - that is,</p>
<div class="fragment"><div class="line">cmake --preset msvc/release/ci/with-external-asymptote-pdf</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md32"></a>
If generating &lt;tt&gt;asymptote.pdf&lt;/tt&gt; as part of build process</h3>
<p>Use the <code>msvc/release</code> build preset for cmake.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
Building Asymptote install files</h2>
<p>The cmake target <code>asy-pre-nsis-targets</code> should build everything on the <code>C++</code> side needed for asymptote installation.</p>
<h3><a class="anchor" id="autotoc_md34"></a>
Generating the installer file</h3>
<p>After building <code>asy-pre-nsis-targets</code>, install using CMake. Note that this does not install into the program files directory, but rather, to a "local install root" at <code>&lt;asymptote-repo&gt;/cmake-install-w32-nsis-release/</code>.</p>
<p>Due to how google test build files are written (as of currently), installing every component may result in an error (in particular, with <code>gmock.lib</code>). This can be remedied by installing only the component needed for installer generation: <code>asy-pre-nsis</code> To do this, run</p>
<div class="fragment"><div class="line">cmake --install cmake-build-msvc/release --component asy-pre-nsis</div>
</div><!-- fragment --><p>After building all the required dependencies, navigate to the directory <code>&lt;asymptote-repo&gt;/cmake-install-w32-nsis-release/</code>. There, a script called <code>build-asy-installer.ps1</code> script is present. Run that script. It will prompt for the location of <code>makensis.exe</code> from the NSIS. Specify the path to <code>makensis.exe</code>.</p>
<p>After this, the script should generate the installer file with the name <code>asymptote-&lt;version&gt;-setup.exe</code>. This is the setup file ready for distribution. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://raw.githubusercontent.com/felixfuchsff/asymptote-doc/refs/heads/master/doxygen.conf"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
